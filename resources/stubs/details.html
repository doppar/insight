<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doppar Insight - Request {{ID}}</title>
    <style>{{CSS}}</style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-title">
                <span><img src="https://doppar.com/logo.png" alt="Doppar Logo" width="32" height="32"> Doppar Insight Profiler</span>
                <span class="badge badge-success">{{STATUS}}</span>
            </div>
            <div class="header-info">
                <div class="info-item">
                    <span class="info-label">Request ID</span>
                    <span class="info-value">{{ID}}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Method & Path</span>
                    <span class="info-value">{{METHOD}} {{ROUTE}}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Duration</span>
                    <span class="info-value">{{DURATION}} ms</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Memory Peak</span>
                    <span class="info-value">{{MEMORY_PEAK}} MB</span>
                </div>
                <div class="info-item">
                    <span class="info-label">PHP Version</span>
                    <span class="info-value">{{PHP_VERSION}}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Framework</span>
                    <span class="info-value"><img src="https://doppar.com/logo.png" alt="Doppar Logo" width="16" height="16">Doppar v{{FRAMEWORK_VERSION}}</span>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab-nav">
                <button class="tab-button active" data-tab="overview">Overview</button>
                <button class="tab-button" data-tab="http">HTTP</button>
                <button class="tab-button" data-tab="database">Database</button>
                <button class="tab-button" data-tab="cache">Cache</button>
                <button class="tab-button" data-tab="auth">Auth</button>
                <button class="tab-button" data-tab="request">Request</button>
                <button class="tab-button" data-tab="response">Response</button>
                <button class="tab-button" data-tab="performance">Performance</button>
                <button class="tab-button" data-tab="session">Session</button>
            </div>
            
            <div class="tab-content">
                <!-- Overview Tab -->
                <div class="tab-pane active" id="overview">
                    <div class="section">
                        <div class="section-title">Request Summary</div>
                        <div class="row"><span class="key">Request ID:</span><span class="val">{{ID}}</span></div>
                        <div class="row"><span class="key">Method:</span><span class="val">{{METHOD}}</span></div>
                        <div class="row"><span class="key">Route:</span><span class="val">{{ROUTE}}</span></div>
                        <div class="row"><span class="key">Status Code:</span><span class="val">{{STATUS}}</span></div>
                        <div class="row"><span class="key">Duration:</span><span class="val">{{DURATION}} ms</span></div>
                        <div class="row"><span class="key">Memory Peak:</span><span class="val">{{MEMORY_PEAK}} MB</span></div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">
                            <span>Database Queries</span>
                            <span class="badge badge-info">{{SQL_TOTAL_COUNT}} queries</span>
                            <span class="badge badge-success">{{SQL_TOTAL_TIME}} ms</span>
                        </div>
                        <div id="overview-sql-summary"></div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Cache Operations</div>
                        <div id="overview-cache-summary"></div>
                    </div>
                </div>
                
                <!-- HTTP Tab -->
                <div class="tab-pane" id="http">
                    <div id="http-details"></div>
                </div>
                
                <!-- Database Tab -->
                <div class="tab-pane" id="database">
                    <div class="section">
                        <div class="section-title">
                            <span>SQL Queries</span>
                            <span class="badge badge-info">{{SQL_TOTAL_COUNT}} queries</span>
                            <span class="badge badge-success">{{SQL_TOTAL_TIME}} ms</span>
                        </div>
                        <div id="sql-queries-list"></div>
                    </div>
                </div>
                
                <!-- Auth Tab -->
                <div class="tab-pane" id="auth">
                    <div class="section">
                        <div class="section-title">Authentication</div>
                        <div id="auth-details"></div>
                    </div>
                </div>
                
                <!-- Request Tab -->
                <div class="tab-pane" id="request">
                    <div class="section">
                        <div class="section-title">Request Details</div>
                        <div id="request-details"></div>
                    </div>
                </div>
                
                <!-- Response Tab -->
                <div class="tab-pane" id="response">
                    <div class="section">
                        <div class="section-title">Response Details</div>
                        <div id="response-details"></div>
                    </div>
                </div>
                
                <!-- Performance Tab -->
                <div class="tab-pane" id="performance">
                    <div class="section">
                        <div class="section-title">Performance Metrics</div>
                        <div id="performance-metrics"></div>
                    </div>
                </div>
                
                <!-- Cache Tab -->
                <div class="tab-pane" id="cache">
                    <div class="section">
                        <div class="section-title">Cache Operations</div>
                        <div id="cache-operations-list"></div>
                    </div>
                </div>
                
                <!-- Session Tab -->
                <div class="tab-pane" id="session">
                    <div class="section">
                        <div class="section-title">Session Details</div>
                        <div id="session-details"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        {{JS}}
        
        // Initialize with server data
        const profilerData = {{DATA_JSON}};
        
        // Store redirect chain in a data attribute for HTTP component
        const redirectChain = {{REDIRECT_CHAIN_JSON}};
        if (redirectChain && redirectChain.length > 0) {
            document.body.setAttribute('data-redirect-chain', JSON.stringify(redirectChain));
        }
        
        DopparInsight.init(profilerData);
    </script>
</body>
</html>
