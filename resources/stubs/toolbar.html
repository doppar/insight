<!-- Doppar Profiler (Shadow DOM isolated) -->
<div id="doppar-profiler" data-request-id="{{ID}}" data-is-redirect="{{IS_REDIRECT}}" data-redirect-url="{{REDIRECT_URL}}" data-redirect-chain="{{REDIRECT_CHAIN}}" data-auth-authenticated="{{AUTH_AUTHENTICATED}}" data-auth-user-name="{{AUTH_USER_NAME}}" data-auth-user-email="{{AUTH_USER_EMAIL}}">
  <template id="dp-template">
    <style>{{CSS}}</style>
    <div class="dp-root">
      <div class="dp-left">
        <span class="dp-badge">{{STATUS}}</span>
        <span class="dp-badge dp-badge-warning dp-redirect" style="display:none">Redirect</span>
        <span class="dp-item">{{METHOD}} {{PATH}}</span>
      </div>
      <div class="dp-right">
        <span class="dp-item dp-auth" style="display:none"><span class="dp-auth-name"></span></span>
        <span class="dp-item dp-version"> PHP {{PHP_VERSION}}</span>
        <span class="dp-item dp-version"><img src="https://doppar.com/logo.png" alt="Doppar Logo" width="16" height="16"> v{{FRAMEWORK_VERSION}}</span>
        <span class="dp-item">{{DURATION}} ms</span>
        <span class="dp-item dp-sql">üóÑÔ∏è {{SQL_COUNT}} queries ({{SQL_TIME}} ms)</span>
        <button class="dp-btn" onclick="DopparProfiler.openDetailsPage()">Details</button>
        <button class="dp-btn" onclick="DopparProfiler.toggle()">Quick View</button>
      </div>
    </div>
  </template>
  <script>(function(){
    try{
      var host=document.getElementById('doppar-profiler');
      if(!host||host.shadowRoot){return}
      var root=host.attachShadow({mode:'open'});
      var tpl=host.querySelector('#dp-template');
      if(tpl&&tpl.content){ root.appendChild(tpl.content.cloneNode(true)); }
      host.textContent='';
      // Show redirect indicator if there's a redirect chain
      var chainData = host.dataset.redirectChain;
      if(chainData && chainData !== '[]'){
        var redirectEl=root.querySelector('.dp-redirect');
        if(redirectEl){redirectEl.style.display='inline-block';}
      }
      // Also show if current request is a redirect
      if(host.dataset.isRedirect==='true'){
        var redirectEl=root.querySelector('.dp-redirect');
        if(redirectEl){redirectEl.style.display='inline-block';}
      }
      // Show auth info if user is authenticated
      if(host.dataset.authAuthenticated==='true'){
        var authEl=root.querySelector('.dp-auth');
        var authNameEl=root.querySelector('.dp-auth-name');
        if(authEl && authNameEl){
          authNameEl.textContent=host.dataset.authUserName || 'User';
          authEl.style.display='inline-block';
        }
      }
    }catch(e){}
  })();</script>
</div>
<script>{{JS}}</script>
<!-- /Doppar Profiler -->
